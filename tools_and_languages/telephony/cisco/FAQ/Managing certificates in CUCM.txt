=============================
Managing certificates in CUCM
=============================

- APAS-CUCM certificate exchange
- Server Certificate Types
- How to list CUCM certificates?

-----------------------------------------------------------------------------------------------------------------------------------------------------
APAS-CUCM certificate exchange
==============================

APAS needs trust certificate from CUCM for SSL/TLS connections and vica versa.

Certificate APAS -> CUCM
------------------------
1. Export from APAS
- APAS/Global/Security
- In certificate with alias 'andphone' click 'Export'
- Save certificate

2. Import into CUCM
- Navigation: Cisco Unified OS Administration
- Security/Certificate Management/(Find)  - to check existing certificates
- Click 'Upload Certificate' button
	- Certificate Name:		CallManager-trust
	- Root Certificate:		-
	- Description:			<OPTIONAL>
	Click: (Upload)

	
Certificate CUCM -> APAS
------------------------
1. Export from CUCM
- Navigation: Cisco Unified OS Administration
- Security/Certificate Management/(Find)
- Choose 'CallManager.pem' (cert - Self-signed certificate generated by system)
- Click (Download) button to download 'CallManager.pem'

2. Import into APAS


NOTE: You can delete unused/bad trust certificates from CUCM if you choose a PEM and click 'Delete' button.


-----------------------------------------------------------------------------------------------------------------------------------------------------
Server Certificate Types
========================
Cisco uses the following self-signed (own) certificate types in Cisco Unified Communications Manager servers:

	• HTTPS certificate (Tomcat)
		A self-signed root certificate gets generated during the Cisco Unified Communications Manager installation for the HTTPS server. 
		Cisco Unity Connection uses this certificate for SMTP and IMAP services.

	• CallManager certificate
		A self-signed root certificate automatically installs when you install Cisco Unified Communications Manager on the Cisco Unified Communications Manager server.

	• CAPF certificate
		The system copies this root certificate, which gets generated during Cisco Unified Communications Manager installation, 
		to your server or to all servers in the cluster after you complete the Cisco CTL client configuration.

	• IPSec certificate (ipsec_cert)
		A self-signed root certificate gets generated during Cisco Unified Communications Manager installation for IPSec connections with MGCP and H.323 gateways.

	• SRST-enabled gateway certificate
		When you configure a secure SRST reference in Cisco Unified Communications Manager Administration, Cisco Unified Communications Manager retrieves the SRST-enabled gateway 
		certificate from the gateway and stores it in the Cisco Unified Communications Manager database. After you reset the devices, the certificategets added to the phone configuration file. 
		Because the certificate is stored in the database, you cannot manage this certificate with the certificate management tool.

	• Phone Certificates trust store (Phone-trust)
		Cisco Unified Communications Manager uses this certificate type to support HTTPs access on phones. You can upload certificates to the Phone-trust store by using the Cisco Unified Communications Operating System GUI. 
		These certificates are subsequently downloaded to the phones by means of the CTL file mechanism to support secure web access (HTTPS) from Cisco Unified IP Phones.

Cisco Unified Communications Manager imports the following certificate types to the CallManager trust store:

	• Cisco Unity server or Cisco Unity Connection certificate
		Cisco Unity and Cisco Unity Connection use this self-signed root certificate to sign the Cisco Unity SCCP and Cisco Unity Connection SCCP device certificates. 
		For Cisco Unity, the Cisco Unity Telephony Integration Manager (UTIM) manages this certificate. For Cisco Unity Connection, Cisco Unity Connection Administration manages this certificate.

	• Cisco Unity and Cisco Unity Connection SCCP device certificates
		Cisco Unity and Cisco Unity Connection SCCP devices use this signed certificate to establish a TLS connection with Cisco Unified Communications Manager. 

	The certificate name represents a hash of the certificate subject name, which is based on the voice-mail server name. Every device (or port) gets issued a certificate that is rooted at the root certificate.

	• SIP Proxy server certificate
		A SIP user agent that connects via a SIP trunk authenticates to Cisco Unified Communications Manager if the CallManager trust store contains the SIP user agent certificate and if the SIP user agent 
		contains the Cisco Unified Communications Manager certificate in its trust store.

	The following is an additional trust store:

	• LDAP Corporate Directory trust store (directory-trust)
		Cisco Unified Communications Manager uses these certificates to support LDAP over SSL for directory sync and user authentication.

-----------------------------------------------------------------------------------------------------------------------------------------------------
How to list CUCM certificates?
==============================
Method 1:
	
	CUCM/Cisco Unified OS Administration/Security/Certificate Management/(Find)
		
Method 2:

	Sometimes you need a direct way because of a bug when deleted certificates are stuck in the database.
	In this case you can read entries direct from CUCM database:
	
		- login with Admin CLI
		- call:
		
			run sql select pkid, servername, subjectname, issuername from certificate
			
			run sql select pkid, servername, subjectname, issuername from certificate where issuername like '%example%'
			